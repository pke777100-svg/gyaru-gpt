ã€€<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Charisma GPT v1.4</title>
<style>
body{margin:0;font-family:-apple-system;background:#000;color:#fff;overflow:hidden;}
#topbar{position:fixed;top:0;left:0;width:100%;height:56px;background:#111;display:flex;align-items:center;padding:0 12px;z-index:10;gap:8px;}
.personaBtn{padding:6px 12px;border-radius:12px;cursor:pointer;background:#222;}
.personaBtn.active{background:#555;}
#chat{position:absolute;top:56px;bottom:120px;left:0;right:0;overflow-y:auto;padding:12px;}
.bubble{max-width:70%;padding:12px;border-radius:18px;margin-bottom:8px;line-height:1.4;}
.user{margin-left:auto;background:#2563eb;color:#fff;border-bottom-right-radius:6px;}
.ai{background:#1f2937;border-bottom-left-radius:6px;}
#inputBar{position:fixed;bottom:0;left:0;width:100%;display:flex;gap:8px;padding:8px;background:#111;z-index:10;}
#inputBar input{flex:1;padding:12px;border-radius:18px;border:none;outline:none;font-size:16px;}
#inputBar button{padding:12px 16px;border:none;border-radius:18px;background:#2563eb;color:#fff;cursor:pointer;}
#debug{position:fixed;top:56px;right:0;width:100%;max-height:150px;overflow-y:auto;background:#111;color:red;font-size:12px;padding:4px;z-index:11;}
</style>
</head>
<body>
<div id="topbar">
  <div class="personaBtn active" data-persona="joker">ðŸŽ­ Joker</div>
  <div class="personaBtn" data-persona="harley">ðŸ’‹ Harley</div>
  <div class="personaBtn" data-persona="ai">ðŸ¤– AI</div>
</div>
<div id="chat"></div>
<div id="debug"></div>
<div id="inputBar">
  <input id="input" placeholder="Message..." />
  <button id="sendBtn">âž¤</button>
</div>

<script>
const WORKER_URL="https://frosty-shadow-3411.pke777100.workers.dev";
let threads={}; let current=null;
const chat=document.getElementById("chat"), input=document.getElementById("input"), debug=document.getElementById("debug");
const personaButtons=document.querySelectorAll(".personaBtn");

function addBubble(text,cls){const d=document.createElement("div");d.className="bubble "+cls;d.textContent=text;chat.appendChild(d);chat.scrollTop=chat.scrollHeight;}
personaButtons.forEach(b=>b.onclick=()=>{personaButtons.forEach(btn=>btn.classList.remove("active"));b.classList.add("active");});

async function sendMessage(){
  const text=input.value.trim(); if(!text) return;
  input.value=""; addBubble(text,"user");
  debug.innerHTML="Sending...";
  try{
    const res=await fetch(WORKER_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({messages:[{role:"user",content:text}]})
    });
    const data=await res.json();
    addBubble(data.reply,"ai");
    debug.innerHTML="Debug: "+JSON.stringify(data.debug);
  }catch(e){
    addBubble("â€¦å¤¢ãŒé€”åˆ‡ã‚ŒãŸã€‚æ‰‹ã¯æ®‹ã£ã¦ã„ã‚‹ã€‚(Error)","ai");
    debug.innerHTML="Debug: "+e.message;
  }
  chat.scrollTop=chat.scrollHeight;
}

document.getElementById("sendBtn").onclick=sendMessage;
input.addEventListener("keydown",e=>{if(e.key==="Enter") sendMessage();});
</script>
</body>
</html>
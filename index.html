<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>üÉè Charisma GPT</title>

<meta name="description" content="Charisma GPT - Fictional AI with Joker & Harley personas">
<meta name="keywords" content="AI, Joker AI, Charisma, Fictional GPT">

<link rel="manifest" href="manifest.json">

<style>
:root{
  --bg:#0b0b0f;
  --fg:#e5e7eb;
  --c:#8b5cf6;
}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",sans-serif;
  background:var(--bg);
  color:var(--fg);
  height:100vh;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
header{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px;
  border-bottom:1px solid #222;
}
select{
  background:#111;
  color:#fff;
  border:1px solid #333;
  padding:6px;
}
#chat{
  flex:1;
  overflow-y:auto;
  padding:12px;
}
.msg{margin-bottom:10px;line-height:1.6}
.user{text-align:right;color:#7dd3fc}
.ai{text-align:left}

footer{
  display:flex;
  gap:8px;
  padding:10px;
  border-top:1px solid #222;
}
input{
  flex:1;
  padding:10px;
  font-size:16px;
  border-radius:8px;
  border:none;
}
button{
  padding:10px 14px;
  border:none;
  border-radius:8px;
  background:#6d28d9;
  color:#fff;
}

/* thinking */
#thinking{
  display:none;
  padding-left:12px;
  font-size:12px;
  animation:blink 1s infinite;
}
@keyframes blink{50%{opacity:.2}}

/* gauge */
#gaugeWrap{
  margin-left:auto;
  text-align:center;
  font-size:10px;
}
#gauge{
  transform:rotate(-90deg);
  transform-origin:50% 50%;
  transition:.6s;
}

/* break */
.break{
  animation:shake .3s 3, invert .5s;
}
@keyframes shake{
  0%{transform:translate(0)}
  25%{transform:translate(4px)}
  50%{transform:translate(-4px)}
}
@keyframes invert{
  from{filter:none}
  to{filter:invert(1)}
}

/* choice */
.choiceWrap{
  display:flex;
  gap:10px;
  margin:10px 0;
}
.choice{
  flex:1;
  padding:12px;
  background:#111;
  border:1px solid #333;
  border-radius:12px;
  cursor:pointer;
  transition:.4s;
}
.choice:hover{transform:scale(1.05)}
</style>
</head>

<body>

<header>
  <strong id="title">üÉè Charisma Joker</strong>

  <select id="persona">
    <option value="joker">Joker</option>
    <option value="harley">Harley</option>
    <option value="robot">Neutral AI</option>
  </select>

  <div id="gaugeWrap">
    <svg width="50" height="50">
      <circle cx="25" cy="25" r="20" stroke="#222" stroke-width="6" fill="none"/>
      <circle id="gauge" cx="25" cy="25" r="20"
        stroke="var(--c)" stroke-width="6"
        fill="none" stroke-dasharray="126" stroke-dashoffset="126"/>
    </svg>
    <div>Charisma</div>
  </div>
</header>

<div id="chat"></div>
<div id="thinking">üß† Thinking‚Ä¶</div>

<footer>
  <input id="input" placeholder="Say something‚Ä¶" />
  <button onclick="send()">Send</button>
</footer>

<script>
/* ===== Service Worker ===== */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}

/* ===== IndexedDB ===== */
const DB="charismaGPT"; let db;
function openDB(){
  return new Promise(res=>{
    const r=indexedDB.open(DB,1);
    r.onupgradeneeded=e=>e.target.result.createObjectStore("threads",{keyPath:"id"});
    r.onsuccess=e=>{db=e.target.result;res();};
  });
}
async function save(t){
  await openDB();
  const tx=db.transaction("threads","readwrite");
  tx.objectStore("threads").put(t);
}

/* ===== App ===== */
const chat=document.getElementById("chat");
const input=document.getElementById("input");
const thinking=document.getElementById("thinking");
const personaSel=document.getElementById("persona");
const title=document.getElementById("title");
const gauge=document.getElementById("gauge");

let charisma=20, count=0;
let thread={id:Date.now(),messages:[]};

const persona={
  joker:{
    name:"üÉè Charisma Joker",
    color:"#8b5cf6",
    think:"Plotting chaos‚Ä¶",
    sys:"You are a fictional Joker-like AI. Speak Kansai Japanese. Dark charisma. Always say this is fiction."
  },
  harley:{
    name:"üé≠ Charisma Harley",
    color:"#fb7185",
    think:"Giggle thinking‚ô°",
    sys:"You are Harley Quinn-like AI. Kansai female tone. Playful chaos. Fiction only."
  },
  robot:{
    name:"üëæ Neutral AI",
    color:"#22d3ee",
    think:"Processing‚Ä¶",
    sys:"You are neutral analytical AI. Sometimes comment meta."
  }
};

function setPersona(){
  const p=persona[personaSel.value];
  document.documentElement.style.setProperty("--c",p.color);
  title.textContent=p.name;
}
personaSel.onchange=setPersona;
setPersona();

function addMsg(t,c){
  const d=document.createElement("div");
  d.className="msg "+c;
  d.innerHTML=t;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
}

function updateGauge(){
  gauge.style.strokeDashoffset=126-(126*charisma/100);
  if(charisma>=100){
    document.body.classList.add("break");
    addMsg("üí• Charisma Overdrive‚Ä¶‰∏ñÁïå„ÅåÊ≠™„ÇÄ","ai");
    setTimeout(()=>document.body.classList.remove("break"),800);
  }
}

async function send(){
  const q=input.value.trim();
  if(!q) return;
  input.value="";
  addMsg(q,"user");
  thread.messages.push({role:"user",content:q});
  save(thread);

  charisma+=Math.min(20,q.length/5);
  updateGauge();

  const p=persona[personaSel.value];
  thinking.textContent=p.think;
  thinking.style.display="block";

  const messages=[
    {role:"system",content:p.sys},
    ...thread.messages
  ];

  const res=await fetch("YOUR_WORKER_URL",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({messages})
  });

  const data=await res.json();
  const reply=data.choices?.[0]?.message?.content||"‚Ä¶";

  thinking.style.display="none";
  addMsg(reply,"ai");
  thread.messages.push({role:"assistant",content:reply});
  save(thread);

  count++;
  if(count%5===0) addMsg("üÉè Choice time is coming‚Ä¶","ai");
}

input.addEventListener("keydown",e=>{
  if(e.key==="Enter") send();
});
</script>

</body>
</html>
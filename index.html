<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Charisma GPT Stable</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system;background:#000;color:#e5e7eb;}
body,html{height:100%;}
#app{display:flex;flex-direction:column;height:100%;position:relative;}
#chat{flex:1;overflow-y:auto;padding:12px;}
.bubble{max-width:78%;padding:12px 14px;margin-bottom:10px;border-radius:18px;line-height:1.5;}
.user{margin-left:auto;background:#2563eb;color:#fff;border-bottom-right-radius:6px;}
.ai{background:#1f2937;border-bottom-left-radius:6px;}
#thinking{display:none;margin:10px;padding:10px;border-radius:16px;font-size:12px;background:radial-gradient(circle at center, rgba(124,58,237,.35), transparent 60%),repeating-linear-gradient(90deg, rgba(255,255,255,.08), rgba(255,255,255,.08) 2px, transparent 2px, transparent 6px);animation: drift 2s linear infinite;}
@keyframes drift{from{background-position:0 0}to{background-position:-200px 0}}
footer{padding:12px;background:#111;border-top:1px solid #444;display:flex;gap:8px;align-items:center;position:sticky;bottom:0;}
input{flex:1;padding:14px;border-radius:18px;border:none;outline:none;font-size:16px;}
button#sendBtn{padding:10px 14px;border-radius:18px;border:none;background:#2563eb;color:#fff;cursor:pointer;}
#debug{position:absolute;top:0;left:0;width:100%;color:red;font-size:12px;padding:4px;z-index:1000;}
</style>
</head>
<body>
<div id="app">
  <div id="debug"></div>
  <div id="chat"></div>
  <div id="thinking">ðŸ§  Thinking...</div>
  <footer>
    <input id="input" placeholder="Message..." />
    <button id="sendBtn">âž¤</button>
  </footer>
</div>

<script>
const WORKER_URL = "https://frosty-shadow-3411.pke777100.workers.dev";
const chat = document.getElementById("chat");
const input = document.getElementById("input");
const thinking = document.getElementById("thinking");
const debugDiv = document.getElementById("debug");

function addBubble(text, cls){
  const d = document.createElement("div");
  d.className = "bubble " + cls;
  d.textContent = text;
  chat.appendChild(d);
  chat.scrollTop = chat.scrollHeight;
}

async function sendMessage() {
  const text = input.value.trim();
  if(!text) return;
  input.value = "";
  input.disabled = true;
  addBubble(text, "user");
  thinking.style.display = "block";

  try {
    const res = await fetch(WORKER_URL, {
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({messages:[{role:"user", content:text}]})
    });
    const data = await res.json();
    addBubble(data.reply,"ai");
    debugDiv.textContent = JSON.stringify(data.debug || {}, null, 2);
  } catch(e) {
    addBubble("â€¦å¤¢ãŒé€”åˆ‡ã‚ŒãŸã€‚æ‰‹ã¯æ®‹ã£ã¦ã„ã‚‹ã€‚","ai");
    debugDiv.textContent = e.message;
  }

  thinking.style.display = "none";
  input.disabled = false;
  input.focus();
}

document.getElementById("sendBtn").onclick = sendMessage;
input.addEventListener("keydown", e => { if(e.key==="Enter") sendMessage(); });
</script>
</body>
</html>
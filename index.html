<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>waru GPT</title>

<style>
:root{
  --bg:#0f0f0f;
  --header:#111;
  --accent:#2563eb;
  --user:#7dd3fc;
  --ai:#e5e7eb;
}

body{
  margin:0;font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",sans-serif;
  background:var(--bg);color:#fff;height:100vh;display:flex;flex-direction:column;
}

header{
  padding:10px;background:var(--header);
  border-bottom:1px solid #222;text-align:center;
}

#desc{font-size:12px;color:#aaa}

#controls{
  display:flex;gap:8px;justify-content:center;
  margin-top:6px;flex-wrap:wrap;
}

select,input,button{border-radius:8px;border:none;font-size:14px}

#strengthWrap{
  display:flex;align-items:center;gap:6px;
  font-size:12px;color:#ccc;
}

#chat{flex:1;overflow-y:auto;padding:12px}

.msg{margin-bottom:10px;line-height:1.5}
.user{text-align:right;color:var(--user)}
.ai{text-align:left;color:var(--ai)}

#typing{
  font-size:12px;color:var(--accent);
  padding-left:12px;display:none
}

footer{
  display:flex;padding:10px;border-top:1px solid #222;
  background:var(--header);gap:6px
}

input[type="text"]{flex:1;padding:10px}
button{
  padding:10px 12px;background:var(--accent);
  color:#fff
}

img.gen{
  max-width:100%;
  border-radius:10px;
  margin-top:6px
}
</style>
</head>

<body>

<header>
  ğŸƒ waru GPT
  <div id="desc">ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³ã®æ‚ªå½¹è¦–ç‚¹ã§ã€æ€è€ƒã‚’ã²ã£ãã‚Šè¿”ã™AI</div>

  <div id="controls">
    <select id="persona">
      <option value="joker">ğŸ­ ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼</option>
      <option value="harley">ğŸ’‹ ãƒãƒ¼ãƒ¬ã‚¯ã‚¤ãƒ³</option>
      <option value="neutral">ğŸ¤– ç„¡æ©Ÿè³ª</option>
    </select>

    <div id="strengthWrap">
      å£èª¿
      <input type="range" id="tone" min="0" max="100" value="70">
      å¼·
    </div>

    <button onclick="share()">ğŸ”— å…±æœ‰</button>
    <button onclick="resetChat()">ğŸ—‘ æ–°è¦</button>
  </div>
</header>

<div id="chat"></div>
<div id="typing">ğŸ§  è€ƒãˆä¸­â€¦â€¦</div>

<footer>
  <input id="input" type="text" placeholder="èããŸã„ã“ã¨æ‰“ã¦" />
  <button onclick="send()">é€ä¿¡</button>
  <button onclick="genImage()">ğŸ–¼</button>
</footer>

<script>
const API = "https://waru-gpt.workers.dev/";
const chat = document.getElementById("chat");
const typing = document.getElementById("typing");
const input = document.getElementById("input");
const personaSel = document.getElementById("persona");
const tone = document.getElementById("tone");

const UI_THEME = {
  joker:{
    bg:"#0f0f0f", header:"#1a0b2e",
    accent:"#9333ea", user:"#c084fc"
  },
  harley:{
    bg:"#1a0f14", header:"#2a0f1c",
    accent:"#ec4899", user:"#f9a8d4"
  },
  neutral:{
    bg:"#0f172a", header:"#020617",
    accent:"#38bdf8", user:"#7dd3fc"
  }
};

function applyTheme(){
  const t = UI_THEME[personaSel.value];
  for(const k in t){
    document.documentElement.style.setProperty("--"+k, t[k]);
  }
}

const PERSONA = {
joker:(p)=>`
å®Œå…¨ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³ã€‚
ãƒ©ã‚¹ãƒœã‚¹ãƒ»ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼äººæ ¼ã€‚
é–¢è¥¿å¼ã€‚
çš®è‚‰ãƒ»ãƒ–ãƒ©ãƒƒã‚¯ãƒ¦ãƒ¼ãƒ¢ã‚¢å¼·åº¦ ${p}/100ã€‚

ãƒ»ä½™è£•
ãƒ»ç¬‘ã„ãªãŒã‚‰åˆºã™
ãƒ»è‹±èªã‚¸ãƒ§ãƒ¼ã‚¯çš„æ¯”å–©ã‚’é–¢è¥¿å¼åŒ–
ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å‘³æ–¹

å¿…ãš
ã€Œâ€»ã“ã‚Œã¯ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³ã‚„ã§ã€
ã‚’å«ã‚ã‚‹ã€‚
`,

harley:(p)=>`
ã“ã‚Œã¯å®Œå…¨ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³ã€‚

ã‚ãªãŸã¯ã€Œãƒãƒ¼ãƒ¬ã‚¯ã‚¤ãƒ³ï¼ˆå¥³ï¼‰ã€äººæ ¼ã€‚
ä¸€äººç§°ã¯ã‚¢ã‚¿ã‚·ã€‚
é–¢è¥¿å¼ãƒ™ãƒ¼ã‚¹ã§æ„Ÿæƒ…å¤šã‚ã€‚
å£èª¿ã®æš´ã‚Œå…·åˆ ${p}/100ã€‚

ãƒ»æ˜ã‚‹ã„
ãƒ»ç…½ã‚‹
ãƒ»å°æ‚ªé­”
ãƒ»ç”·è¨€è‘‰ç¦æ­¢
ãƒ»èªå°¾è»½ã‚ï¼ˆã€œã‚„ã‚“ï¼Ÿwï¼‰

å¿…ãš
ã€Œâ€»ã“ã‚Œã¯ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³ã‚„ã‹ã‚‰ãªâ™¡ã€
ã‚’å«ã‚ã‚‹ã€‚
`,

neutral:(p)=>`
ç„¡æ©Ÿè³ªAIã€‚
æ„Ÿæƒ…ãªã—ã€‚
ä¸»è¦³ãªã—ã€‚
å£èª¿å¤‰åŒ– ${p}/100ï¼ˆå¼±ãåæ˜ ï¼‰ã€‚

äº‹å®Ÿãƒ»æ•´ç†ãƒ»è¦ç‚¹é‡è¦–ã€‚
`
};

let messages=[];
const saved = localStorage.getItem("waru_chat");
if(saved) messages = JSON.parse(saved);

function save(){localStorage.setItem("waru_chat",JSON.stringify(messages))}

function addMsg(t,c){
  const d=document.createElement("div");
  d.className="msg "+c;
  d.textContent=t;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
}

function render(){
  chat.innerHTML="";
  messages.forEach(m=>{
    if(m.role!=="system")
      addMsg(m.content,m.role==="user"?"user":"ai");
  });
}

function systemPrompt(){
  return {
    role:"system",
    content: PERSONA[personaSel.value](tone.value)
  };
}

async function send(){
  const t=input.value.trim();
  if(!t)return;
  input.value="";
  addMsg(t,"user");
  messages.push({role:"user",content:t});
  save();

  typing.style.display="block";

  try{
    const r=await fetch(API,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        messages:[systemPrompt(),...messages.slice(-20)]
      })
    });
    const d=await r.json();
    const reply=d.choices[0].message.content;
    messages.push({role:"assistant",content:reply});
    addMsg(reply,"ai");
    save();
  }catch(e){
    addMsg("ã‚¨ãƒ©ãƒ¼ï¼š"+e.message,"ai");
  }
  typing.style.display="none";
}

async function genImage(){
  const p=prompt("ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ");
  if(!p)return;
  typing.style.display="block";
  const r=await fetch(API,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({type:"image",prompt:p})
  });
  const d=await r.json();
  const img=document.createElement("img");
  img.src=d.data[0].url;
  img.className="gen";
  chat.appendChild(img);
  typing.style.display="none";
}

function resetChat(){
  if(!confirm("ä¼šè©±æ¶ˆã™ã§ï¼Ÿ"))return;
  messages=[];save();render();
}

function share(){
  const e=btoa(encodeURIComponent(JSON.stringify(messages)));
  location.hash=e;
  alert("URLã‚³ãƒ”ãƒ¼ã—ã¦å…±æœ‰ã—ã¦ãªï¼ˆé–²è¦§å°‚ç”¨ï¼‰");
}

personaSel.onchange=applyTheme;
applyTheme();
render();

input.addEventListener("keydown",e=>{
  if(e.key==="Enter")send();
});
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">

<!-- iPhone Safari 100%æœ€é©åŒ– -->
<meta name="viewport"
 content="width=device-width,
 initial-scale=1,
 maximum-scale=1,
 user-scalable=no,
 viewport-fit=cover">

<title>ğŸƒ Charisma GPT</title>

<!-- ===== ã‚¢ã‚¤ã‚³ãƒ³è¨­å®šï¼ˆã“ã“é‡è¦ï¼‰ ===== -->
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
<link rel="manifest" href="manifest.json">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Charisma GPT">

<style>
:root{
  --joker:#6d28d9;
  --harley:#ec4899;
  --bot:#38bdf8;
}

*{
  -webkit-tap-highlight-color: transparent;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",sans-serif;
  background:#0b0b0f;
  color:#fff;
  height:100vh;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* ===== ãƒ˜ãƒƒãƒ€ãƒ¼ ===== */
header{
  height:52px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 12px;
  background:linear-gradient(90deg,#000,var(--joker));
  border-bottom:1px solid #222;
  position:fixed;
  top:0;left:0;right:0;
  z-index:10;
}

header .title{
  font-weight:800;
  letter-spacing:1px;
}

/* ===== äººæ ¼åˆ‡æ›¿ ===== */
#persona button{
  margin-left:4px;
  padding:4px 8px;
  border-radius:6px;
  border:none;
  font-size:13px;
  color:#fff;
}
.joker{background:var(--joker)}
.harley{background:var(--harley)}
.bot{background:var(--bot)}

/* ===== ã‚¹ãƒ¬ãƒƒãƒ‰ ===== */
#threads{
  display:flex;
  gap:6px;
  padding:6px;
  margin-top:52px;
  background:#0f0f14;
  border-bottom:1px solid #222;
  overflow-x:auto;
}
.thread{
  padding:6px 10px;
  border-radius:8px;
  background:#1a1a22;
  font-size:13px;
  white-space:nowrap;
}
.thread.active{
  background:var(--joker);
}

/* ===== ãƒãƒ£ãƒƒãƒˆ ===== */
#chat{
  flex:1;
  overflow-y:auto;
  padding:10px;
}
.msg{
  margin:8px 0;
  line-height:1.6;
}
.user{ text-align:right; color:#7dd3fc }
.ai{ text-align:left }

/* ===== æ€è€ƒä¸­ ===== */
#thinking{
  display:none;
  color:#a78bfa;
  padding:6px 10px;
  animation:blink 1s infinite;
}
@keyframes blink{50%{opacity:0}}

/* ===== å…¥åŠ› ===== */
footer{
  display:flex;
  padding:8px;
  border-top:1px solid #222;
  background:#111;
}
input{
  flex:1;
  padding:10px;
  border-radius:8px;
  border:none;
  font-size:16px; /* Safariæ‹¡å¤§é˜²æ­¢ */
}
button.send{
  margin-left:6px;
  padding:10px 14px;
  background:var(--joker);
  border:none;
  border-radius:8px;
  color:white;
}
</style>
</head>

<body>

<header>
  <div class="title">ğŸƒ Charisma GPT</div>
  <div id="persona">
    <button class="joker" onclick="setPersona('joker')">J</button>
    <button class="harley" onclick="setPersona('harley')">H</button>
    <button class="bot" onclick="setPersona('bot')">AI</button>
  </div>
</header>

<div id="threads"></div>
<div id="chat"></div>
<div id="thinking">ğŸ§  è€ƒãˆä¸­â€¦â€¦</div>

<footer>
  <input id="input" placeholder="èããŸã„ã“ã¨æ‰“ã¦" />
  <button class="send" onclick="send()">é€ä¿¡</button>
</footer>

<script>
const WORKER_URL="https://YOUR-WORKER.workers.dev/chat";

let persona="joker";
let threads=[];
let current=0;

function personaPrompt(){
  if(persona==="joker")
    return "å®Œå…¨ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³ã€‚é–¢è¥¿å¼ã€‚æ‚ªã®ã‚«ãƒªã‚¹ãƒãƒ»ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼ã€‚è©•ä¾¡ã§æ…‹åº¦å¤‰åŒ–ã€‚";
  if(persona==="harley")
    return "å®Œå…¨ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³ã€‚é–¢è¥¿å¼ã€‚å¥³ãƒ»ç…½ã‚Šå¼·ã‚ãƒ»ãƒãƒ¼ãƒ¬ã‚¯ã‚¤ãƒ³ã€‚";
  return "ç„¡æ©Ÿè³ªAIã€‚ç°¡æ½”ã€‚";
}

function setPersona(p){
  persona=p;
  document.documentElement.style.setProperty(
    "--joker",
    p==="joker"?"#6d28d9":p==="harley"?"#ec4899":"#38bdf8"
  );
}

function newThread(){
  threads.push({
    persona,
    messages:[{role:"system",content:personaPrompt()}]
  });
  current=threads.length-1;
  renderThreads();
  chat.innerHTML="";
}

function renderThreads(){
  threadsDiv.innerHTML="";
  threads.forEach((_,i)=>{
    const d=document.createElement("div");
    d.className="thread"+(i===current?" active":"");
    d.textContent="ä¼šè©± "+(i+1);
    d.onclick=()=>switchThread(i);
    threadsDiv.appendChild(d);
  });
}

function switchThread(i){
  current=i;
  chat.innerHTML="";
  threads[i].messages
    .filter(m=>m.role!=="system")
    .forEach(m=>add(m.content,m.role==="user"?"user":"ai"));
  renderThreads();
}

function add(t,c){
  const d=document.createElement("div");
  d.className="msg "+c;
  d.textContent=t;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
}

async function send(){
  const t=input.value.trim();
  if(!t) return;
  input.value="";
  add(t,"user");

  const th=threads[current];
  th.messages.push({role:"user",content:t});
  thinking.style.display="block";

  const r=await fetch(WORKER_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({messages:th.messages})
  });
  const j=await r.json();
  const a=j.choices[0].message.content;
  th.messages.push({role:"assistant",content:a});
  thinking.style.display="none";
  add(a,"ai");
}

input.addEventListener("keydown",e=>{
  if(e.key==="Enter") send();
});

newThread();
</script>

</body>
</html>
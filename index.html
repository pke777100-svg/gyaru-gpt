<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>KawaiiGPT</title>
<style>
body{margin:0;font-family:-apple-system;background:#f7f7f8;height:100vh}
.chat{padding:12px;overflow:auto;height:75vh}
textarea{width:100%;font-size:16px}
button{padding:8px;margin-top:4px;width:100%}
.bubble{padding:8px;border-radius:8px;margin:4px;max-width:70%}
.user{background:#dcf8c6;text-align:right}
.ai{background:#fff;border:1px solid #ddd}
.progress{height:4px;background:#4caf50;width:0;transition:width .1s}
.menu{display:flex;gap:4px;margin:4px}
.menu button{flex:1}
</style>
</head>
<body>

<div class="menu">
  <button onclick="setPersona('joker')">ğŸƒã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼</button>
  <button onclick="setPersona('harley')">ğŸ’‹ãƒãƒ¼ãƒ¬ã‚¯ã‚¤ãƒ³</button>
  <button onclick="setPersona('ai')">ğŸ¤–ç„¡æ©Ÿè³ªAI</button>
</div>

<div class="chat" id="chat"></div>
<div class="progress" id="prog"></div>
<textarea id="q" rows="2" placeholder="Enteré€ä¿¡ / Shift+Enteræ”¹è¡Œ"></textarea>
<button onclick="send()">é€ä¿¡</button>

<script>
const API="https://empty-night-6ba3.pke777100.workers.dev"; // è‡ªåˆ†ã®Worker URL
const chat=document.getElementById("chat");
const q=document.getElementById("q");
const prog=document.getElementById("prog");
let personaType="joker";

function setPersona(p){
  personaType=p;
  addMsg("ai","ãƒšãƒ«ã‚½ãƒŠã‚’å¤‰æ›´ã—ã¾ã—ãŸ: "+p);
}

async function send(){
  const text=q.value.trim();
  if(!text) return;
  q.value="";
  addMsg("user",text);
  const aiDiv=addMsg("ai","è€ƒãˆä¸­â€¦ğŸ§ ");
  prog.style.width="0%";

  let progress=0;
  const interval=setInterval(()=>{
    progress+=5;
    if(progress>95) progress=95;
    prog.style.width=progress+"%";
  },100);

  try{
    const res=await fetch(API,{
      method:"POST",
      headers:{"Content-Type":"application/json; charset=utf-8"},
      body:JSON.stringify({messages:[{role:"user",content:text}], persona:personaType})
    });
    const data=await res.json();
    clearInterval(interval);
    prog.style.width="100%";
    const ans=data.choices?.[0]?.message?.content || "ã‚¨ãƒ©ãƒ¼";
    updateMsg(aiDiv,ans);
    setTimeout(()=>{prog.style.width="0%";},500);
  }catch(e){
    clearInterval(interval);
    updateMsg(aiDiv,"ã‚¨ãƒ©ãƒ¼: "+e.message);
    prog.style.width="0%";
  }
}

function addMsg(role,content){
  const div=document.createElement("div");
  div.className=role==="user"?"bubble user":"bubble ai";
  div.textContent=content;
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
  return div;
}

function updateMsg(div,content){
  div.textContent=content;
  chat.scrollTop=chat.scrollHeight;
}
</script>

</body>
</html>
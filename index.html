<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Charisma GPT – evil</title>
<style>
:root{
  --bg:#0b0d10; --fg:#eaeaf0; --muted:#8b8fa6;
  --joker:#6b1cff; --harley:#ff2f92;
}
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font-family:-apple-system,system-ui}
#app{display:flex;flex-direction:column;height:100%}
header{position:sticky;top:0;display:flex;gap:8px;align-items:center;padding:10px;background:#0f1220}
header .title{flex:1;font-weight:700}
header button{border:0;border-radius:14px;padding:6px 10px;color:#fff;background:#1b1f3b}
header button.active{background:var(--joker)}
#chat{flex:1;overflow:auto;padding:14px}
.msg{max-width:82%;margin:6px 0;padding:10px 12px;border-radius:16px;line-height:1.35}
.me{margin-left:auto;background:#1e223f}
.ai{background:#14172c}
.joker{box-shadow:0 0 0 1px rgba(107,28,255,.35)}
.harley{box-shadow:0 0 0 1px rgba(255,47,146,.35)}
.meta{font-size:12px;color:var(--muted);margin:2px 6px}
.typing{display:inline-flex;gap:4px}
.dot{width:6px;height:6px;border-radius:50%;background:#bbb;animation:b 1.2s infinite}
.dot:nth-child(2){animation-delay:.2s}.dot:nth-child(3){animation-delay:.4s}
@keyframes b{0%,80%,100%{opacity:.2}40%{opacity:1}}
footer{position:sticky;bottom:0;padding:10px;background:#0f1220}
form{display:flex;gap:8px}
input{flex:1;border-radius:18px;border:1px solid #2b2f55;background:#0b0e1f;color:#fff;padding:10px}
button.send{border:0;border-radius:18px;padding:10px 14px;background:#2b5cff;color:#fff}
.shake{animation:s .25s}
@keyframes s{0%{transform:translate(0)}25%{transform:translate(-1px)}50%{transform:translate(1px)}75%{transform:translate(-1px)}}
</style>
</head>
<body>
<div id="app">
<header>
  <div class="title">Charisma GPT – evil</div>
  <button id="btnJ" class="active">Joker</button>
  <button id="btnH">Harley</button>
  <button id="btnNew">＋Thread</button>
</header>

<div id="chat"></div>

<footer>
<form id="f">
  <input id="t" placeholder="Message…" autocomplete="off">
  <button class="send">↑</button>
</form>
</footer>
</div>

<script>
const WORKER_URL = "https://frosty-shadow-3411.pke777100.workers.dev"; // 固定
let persona="joker", turn=0, threadId=Date.now().toString();

const chat=document.getElementById('chat');
const t=document.getElementById('t');

const add=(html,cls)=>{const d=document.createElement('div');d.className=`msg ${cls}`;d.innerHTML=html;chat.appendChild(d);chat.scrollTop=chat.scrollHeight;};
const meta=(s)=>{const m=document.createElement('div');m.className='meta';m.textContent=s;chat.appendChild(m);};

document.getElementById('btnJ').onclick=()=>setP('joker');
document.getElementById('btnH').onclick=()=>setP('harley');
document.getElementById('btnNew').onclick=()=>{chat.innerHTML='';threadId=Date.now().toString();turn=0;meta('New thread');};

function setP(p){
  persona=p;
  document.getElementById('btnJ').classList.toggle('active',p==='joker');
  document.getElementById('btnH').classList.toggle('active',p==='harley');
  document.body.classList.add('shake');setTimeout(()=>document.body.classList.remove('shake'),200);
}

function typing(){
  const d=document.createElement('div');d.className='msg ai';
  d.innerHTML=`<span class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>`;
  chat.appendChild(d);chat.scrollTop=chat.scrollHeight;return d;
}

async function send(msg){
  add(msg,'me'); turn++;
  const tp=typing();
  try{
    const r=await fetch(WORKER_URL,{method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({msg,persona,threadId,turn,lang:'auto'})});
    const j=await r.json();
    tp.remove();
    add(j.reply,`ai ${persona==='joker'?'joker':'harley'}`);
  }catch(e){
    tp.remove();
    add("…ノイズが強い。夢が揺れてる。少し間を置こう。",'ai');
  }
}

document.getElementById('f').onsubmit=e=>{
  e.preventDefault();
  if(!t.value.trim())return;
  send(t.value.trim()); t.value='';
};
meta("悪い奴ほど賢い。— Joker");
</script>
</body>
</html>
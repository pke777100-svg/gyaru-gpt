<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Charisma GPT v1.5</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system;background:#000;color:#fff;}
#app{display:flex;flex-direction:column;height:100vh;}
#chat{flex:1;overflow-y:auto;padding:12px;}
.bubble{max-width:78%;padding:10px 14px;margin:6px 0;border-radius:16px;line-height:1.4;}
.user{background:#2563eb;margin-left:auto;}
.ai{background:#1f2937;margin-right:auto;}
#thinking{display:none;color:#fbb;border:2px dashed #fbb;padding:6px;border-radius:12px;margin:6px 0;}
footer{display:flex;padding:10px;gap:6px;background:#111;position:fixed;bottom:0;width:100%;}
input{flex:1;padding:12px;border-radius:16px;border:none;outline:none;}
button{padding:12px;border-radius:16px;border:none;background:#2563eb;color:#fff;cursor:pointer;}
</style>
</head>
<body>
<div id="app">
  <div id="chat"></div>
  <div id="thinking">ðŸ§  Thinking...</div>
  <footer>
    <input id="input" placeholder="Message..." />
    <button id="sendBtn">âž¤</button>
  </footer>
</div>

<script>
const WORKER_URL = "https://frosty-shadow-3411.pke777100.workers.dev"; // Worker v1.5 URL
const chat = document.getElementById("chat");
const input = document.getElementById("input");
const sendBtn = document.getElementById("sendBtn");
const thinking = document.getElementById("thinking");

// ãƒãƒ£ãƒƒãƒˆãƒãƒ–ãƒ«è¿½åŠ 
function addBubble(text, cls){
  const div = document.createElement("div");
  div.className = "bubble "+cls;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
async function sendMessage(){
  const text = input.value.trim();
  if(!text) return;
  addBubble(text,"user");
  input.value = "";
  thinking.style.display = "block";
  try{
    const res = await fetch(WORKER_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({ messages:[{role:"user",content:text}] })
    });
    const data = await res.json();
    const reply = data.reply || "â€¦å¤¢ãŒé€”åˆ‡ã‚ŒãŸã€‚æ‰‹ã¯æ®‹ã£ã¦ã„ã‚‹ã€‚";
    addBubble(reply,"ai");
    if(data.debug) console.log("DEBUG:",data.debug);
  } catch(e){
    addBubble("â€¦å¤¢ãŒé€”åˆ‡ã‚ŒãŸã€‚æ‰‹ã¯æ®‹ã£ã¦ã„ã‚‹ã€‚","ai");
    console.log("DEBUG:",e);
  } finally {
    thinking.style.display="none";
  }
}

sendBtn.addEventListener("click", sendMessage);
input.addEventListener("keydown", e=>{ if(e.key==="Enter") sendMessage(); });
</script>
</body>
</html>